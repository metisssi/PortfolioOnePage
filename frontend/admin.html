<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Admin panel</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body { font-family: sans-serif; background: #111; color: #fff; padding: 2rem; }
    h1   { color: #c0392b; margin-bottom: 2rem; }
    h2   { margin: 1.5rem 0 1rem; font-size: 1.1rem; color: #ccc; }

    label {
      display: block; font-size: 0.8rem; color: #888;
      margin-bottom: 0.3rem; text-transform: uppercase; letter-spacing: 0.08em;
    }

    input, textarea {
      width: 100%; background: #1a1a1a; border: 1px solid #333; color: #fff;
      padding: 0.75rem; border-radius: 6px; font-size: 0.95rem; margin-bottom: 0.75rem;
    }
    textarea { resize: vertical; min-height: 120px; }

    button { background: #c0392b; color: #fff; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-size: 0.95rem; margin-right: 0.5rem; }
    button.secondary { background: #333; }
    button:hover { opacity: 0.85; }

    .card { background: #1a1a1a; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }

    .msg { padding: 0.75rem; border-radius: 6px; margin-top: 1rem; font-size: 0.9rem; }
    .msg.ok  { background: rgba(46,204,113,0.15); color: #2ecc71; }
    .msg.err { background: rgba(192,57,43,0.15);  color: #c0392b; }

    .note { font-size: 0.8rem; color: #666; font-style: italic; margin-top: 0.5rem; }

    /* â”€â”€ Lang tabs â”€â”€ */
    .lang-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid #333; padding-bottom: 0.75rem; }
    .lang-tab {
      background: #222; border: 1px solid #333; color: #aaa; padding: 0.4rem 1.2rem;
      border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 600; letter-spacing: 0.06em;
      transition: all 0.2s;
    }
    .lang-tab.active { background: #c0392b; border-color: #c0392b; color: #fff; }
    .lang-tab:hover:not(.active) { border-color: #555; color: #fff; }

    /* â”€â”€ Lang panels â”€â”€ */
    .lang-panel { display: none; }
    .lang-panel.active { display: block; }

    /* â”€â”€ Gallery â”€â”€ */
    .gallery-list {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem; margin-top: 1rem;
    }
    .gallery-item { position: relative; border-radius: 8px; overflow: hidden; background: #222; }
    .gallery-item img { width: 100%; height: 130px; object-fit: cover; display: block; }
    .gallery-item button { position: absolute; top: 6px; right: 6px; padding: 0.3rem 0.6rem; font-size: 0.8rem; }

    /* â”€â”€ Reviews â”€â”€ */
    .reviews-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .review-item {
      background: #222; padding: 1rem; border-radius: 8px;
      display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem;
    }
    .review-item .info { flex: 1; }
    .review-item .name { font-weight: 600; margin-bottom: 0.3rem; }
    .review-item .text { font-size: 0.9rem; color: #aaa; }

    .badge { font-size: 0.75rem; padding: 0.2rem 0.6rem; border-radius: 100px; }
    .badge.pending  { background: rgba(241,196,15,0.2);  color: #f1c40f; }
    .badge.approved { background: rgba(46,204,113,0.2);  color: #2ecc71; }

    /* â”€â”€ Auth â”€â”€ */
    #login-screen { max-width: 400px; margin: 5rem auto; }
    #app { display: none; max-width: 960px; margin: 0 auto; }
  </style>
</head>
<body>

  <div id="login-screen" class="card">
    <h1>ğŸ”’ Admin</h1>
    <h2>PÅ™ihlÃ¡Å¡enÃ­</h2>
    <input type="password" id="password" placeholder="Heslo" onkeydown="if(event.key==='Enter')login()">
    <button onclick="login()">PÅ™ihlÃ¡sit se</button>
    <div id="login-msg" class="msg" style="display:none"></div>
  </div>

  <div id="app">
    <h1>âš™ï¸ Admin panel</h1>
    <button class="secondary" onclick="logout()">OdhlÃ¡sit</button>

    <!-- â•â• CONTENT â•â• -->
    <div class="card">
      <h2>ğŸ“ Obsah webu</h2>

      <!-- Language tabs -->
      <div class="lang-tabs">
        <button class="lang-tab active" onclick="switchLang('cs', this)">ğŸ‡¨ğŸ‡¿ ÄŒeÅ¡tina</button>
        <button class="lang-tab"        onclick="switchLang('en', this)">ğŸ‡¬ğŸ‡§ English</button>
      </div>

      <!-- â”€â”€ CZECH panel â”€â”€ -->
      <div class="lang-panel active" id="panel-cs">
        <h2>ğŸ“ SluÅ¾by (CZ)</h2>
        <label>Nadpis</label>
        <input id="cs-sluzby-nadpis" placeholder="LÃ©Äba bolestÃ­ zad">
        <label>Seznam sluÅ¾eb (kaÅ¾dÃ¡ na novÃ½ Å™Ã¡dek)</label>
        <textarea id="cs-sluzby-text" placeholder="1. VÃ½hÅ™ezy plotÃ©nek&#10;2. BechtÄ›revova nemoc"></textarea>

        <h2>âœ… ProÄ za mnou? (CZ)</h2>
        <label>Nadpis</label>
        <input id="cs-proc-nadpis" placeholder="ProÄ za mnou?">
        <label>DÅ¯vody (kaÅ¾dÃ½ na novÃ½ Å™Ã¡dek)</label>
        <textarea id="cs-proc-body" placeholder="Metoda nemÃ¡ vedlejÅ¡Ã­ ÃºÄinky&#10;RychlÃ© vÃ½sledky"></textarea>

        <h2>ğŸ‘¤ O mnÄ› (CZ)</h2>
        <label>Nadpis</label>
        <input id="cs-omne-nadpis" placeholder="O mnÄ›">
        <label>Text (krÃ¡tkÃ½ Ãºvod)</label>
        <textarea id="cs-omne-text" style="min-height:80px" placeholder="KrÃ¡tkÃ½ popis..."></textarea>
        <label>Body (kaÅ¾dÃ½ na novÃ½ Å™Ã¡dek)</label>
        <textarea id="cs-omne-body" placeholder="15 let zkuÅ¡enostÃ­&#10;IndividuÃ¡lnÃ­ pÅ™Ã­stup"></textarea>
      </div>

      <!-- â”€â”€ ENGLISH panel â”€â”€ -->
      <div class="lang-panel" id="panel-en">
        <h2>ğŸ“ Services (EN)</h2>
        <label>Heading</label>
        <input id="en-sluzby-nadpis" placeholder="Back Pain Treatment">
        <label>List of services (one per line)</label>
        <textarea id="en-sluzby-text" placeholder="1. Herniated discs&#10;2. Bechterew's disease"></textarea>

        <h2>âœ… Why choose me? (EN)</h2>
        <label>Heading</label>
        <input id="en-proc-nadpis" placeholder="Why choose me?">
        <label>Reasons (one per line)</label>
        <textarea id="en-proc-body" placeholder="No side effects&#10;Fast results"></textarea>

        <h2>ğŸ‘¤ About me (EN)</h2>
        <label>Heading</label>
        <input id="en-omne-nadpis" placeholder="About me">
        <label>Intro text</label>
        <textarea id="en-omne-text" style="min-height:80px" placeholder="Short description..."></textarea>
        <label>Bullet points (one per line)</label>
        <textarea id="en-omne-body" placeholder="15 years of experience&#10;Individual approach"></textarea>
      </div>

      <button onclick="saveContent()">ğŸ’¾ UloÅ¾it vÅ¡e / Save all</button>
      <div id="content-msg" class="msg" style="display:none"></div>
      <p class="note">â„¹ï¸ KontaktnÃ­ Ãºdaje se upravujÃ­ pÅ™Ã­mo v index.html</p>
    </div>

    <!-- â•â• GALLERY â•â• -->
    <div class="card">
      <h2>ğŸ–¼ï¸ Galerie</h2>
      <label>URL obrÃ¡zku</label>
      <input id="gallery-url" placeholder="https://..." oninput="previewGalleryImage()">
      <div id="gallery-preview" style="display:none; margin-bottom:0.75rem;">
        <img id="gallery-preview-img" src="" alt="NÃ¡hled"
          style="max-width:200px; max-height:150px; border-radius:8px; border:1px solid #333; object-fit:cover;">
      </div>
      <label>Jazyk / Language</label>
      <select id="gallery-lang" style="width:100%;background:#1a1a1a;border:1px solid #333;color:#fff;padding:0.75rem;border-radius:6px;font-size:0.95rem;margin-bottom:0.75rem;">
        <option value="all">ğŸŒ Oba jazyky / Both languages</option>
        <option value="cs">ğŸ‡¨ğŸ‡¿ Pouze ÄeÅ¡tina</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English only</option>
      </select>
      <label>Nadpis</label>
      <input id="gallery-nadpis" placeholder="NÃ¡zev fotky">
      <label>Popis (volitelnÃ©)</label>
      <input id="gallery-popis" placeholder="Popis fotky">
      <button onclick="addPhoto()">PÅ™idat foto</button>
      <div id="gallery-msg" class="msg" style="display:none"></div>
      <div class="gallery-list" id="gallery-list"></div>
    </div>

    <!-- â•â• REVIEWS â•â• -->
    <div class="card">
      <h2>â­ Recenze</h2>
      <div class="reviews-list" id="reviews-list"></div>
    </div>
  </div>

  <script>
    const API = '/api';
    // For local dev: const API = 'http://localhost:8000/api';

    let token = localStorage.getItem('admin_token');
    if (token) showApp();

    // â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function login() {
      const password = document.getElementById('password').value;
      const res  = await fetch(`${API}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });
      const data = await res.json();
      if (res.ok) { token = data.token; localStorage.setItem('admin_token', token); showApp(); }
      else showMsg('login-msg', data.message || 'Chyba pÅ™ihlÃ¡Å¡enÃ­', false);
    }

    function logout() { localStorage.removeItem('admin_token'); location.reload(); }

    function showApp() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      loadContent(); loadGallery(); loadReviews();
    }

    // â”€â”€ Lang tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchLang(lang, btn) {
      document.querySelectorAll('.lang-tab').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.lang-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('panel-' + lang).classList.add('active');
    }

    // â”€â”€ Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadContent() {
      const res  = await fetch(`${API}/content`);
      const data = await res.json();

      // Helper: get the right sub-object for a lang
      // Supports both new format { cs:{...}, en:{...} } and old flat format
      function getLang(section, lang) {
        if (!section) return {};
        if (section.cs || section.en) return section[lang] || {};
        // Old flat format â€” treat as Czech only
        return lang === 'cs' ? section : {};
      }

      const csSluzby = getLang(data.sluzby, 'cs');
      const enSluzby = getLang(data.sluzby, 'en');
      const csProc   = getLang(data.proc_za_mnou, 'cs');
      const enProc   = getLang(data.proc_za_mnou, 'en');
      const csOmne   = getLang(data.o_mne, 'cs');
      const enOmne   = getLang(data.o_mne, 'en');

      // CZ fields
      document.getElementById('cs-sluzby-nadpis').value = csSluzby.nadpis || '';
      document.getElementById('cs-sluzby-text').value   = csSluzby.text   || '';
      document.getElementById('cs-proc-nadpis').value   = csProc.nadpis   || '';
      document.getElementById('cs-proc-body').value     = (csProc.body    || []).join('\n');
      document.getElementById('cs-omne-nadpis').value   = csOmne.nadpis   || '';
      document.getElementById('cs-omne-text').value     = csOmne.text     || '';
      document.getElementById('cs-omne-body').value     = (csOmne.body    || []).join('\n');

      // EN fields
      document.getElementById('en-sluzby-nadpis').value = enSluzby.nadpis || '';
      document.getElementById('en-sluzby-text').value   = enSluzby.text   || '';
      document.getElementById('en-proc-nadpis').value   = enProc.nadpis   || '';
      document.getElementById('en-proc-body').value     = (enProc.body    || []).join('\n');
      document.getElementById('en-omne-nadpis').value   = enOmne.nadpis   || '';
      document.getElementById('en-omne-text').value     = enOmne.text     || '';
      document.getElementById('en-omne-body').value     = (enOmne.body    || []).join('\n');
    }

    function lines(id) {
      return document.getElementById(id).value.split('\n').filter(l => l.trim());
    }
    function val(id) {
      return document.getElementById(id).value;
    }

    async function saveContent() {
      const body = {
        sluzby: {
          cs: { nadpis: val('cs-sluzby-nadpis'), text: val('cs-sluzby-text') },
          en: { nadpis: val('en-sluzby-nadpis'), text: val('en-sluzby-text') },
        },
        proc_za_mnou: {
          cs: { nadpis: val('cs-proc-nadpis'), body: lines('cs-proc-body') },
          en: { nadpis: val('en-proc-nadpis'), body: lines('en-proc-body') },
        },
        o_mne: {
          cs: { nadpis: val('cs-omne-nadpis'), text: val('cs-omne-text'), body: lines('cs-omne-body') },
          en: { nadpis: val('en-omne-nadpis'), text: val('en-omne-text'), body: lines('en-omne-body') },
        }
      };

      const res = await fetch(`${API}/content`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify(body)
      });
      showMsg('content-msg', res.ok ? 'UloÅ¾eno âœ“' : 'Chyba!', res.ok);
    }

    // â”€â”€ Gallery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function previewGalleryImage() {
      const url     = document.getElementById('gallery-url').value.trim();
      const preview = document.getElementById('gallery-preview');
      const img     = document.getElementById('gallery-preview-img');
      if (url) {
        img.src = url;
        img.onerror = () => { preview.style.display = 'none'; };
        img.onload  = () => { preview.style.display = 'block'; };
      } else {
        preview.style.display = 'none';
      }
    }

    async function loadGallery() {
      const res   = await fetch(`${API}/gallery`);
      const items = await res.json();
      document.getElementById('gallery-list').innerHTML = items.map(item => {
        const langLabel = item.lang === 'cs' ? 'ğŸ‡¨ğŸ‡¿' : item.lang === 'en' ? 'ğŸ‡¬ğŸ‡§' : 'ğŸŒ';
        return `
        <div class="gallery-item">
          <img src="${item.url}" alt="${item.popis}" onerror="this.src='https://placehold.co/180x130?text=Error'">
          <div style="position:absolute;top:6px;left:6px;font-size:1rem;line-height:1;">${langLabel}</div>
          ${item.nadpis ? `<div style="padding:0.4rem 0.5rem;font-size:0.8rem;font-weight:600;color:#fff;background:rgba(0,0,0,0.6);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.nadpis}</div>` : ''}
          ${item.popis  ? `<div style="padding:0.2rem 0.5rem 0.4rem;font-size:0.7rem;color:#aaa;background:rgba(0,0,0,0.6);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.popis}</div>` : ''}
          <button onclick="deletePhoto('${item._id}')">âœ•</button>
        </div>
      `}).join('');
    }

    async function addPhoto() {
      const url    = document.getElementById('gallery-url').value.trim();
      const nadpis = document.getElementById('gallery-nadpis').value.trim();
      const popis  = document.getElementById('gallery-popis').value.trim();
      const lang   = document.getElementById('gallery-lang').value;
      if (!url) return showMsg('gallery-msg', 'URL je povinnÃ©', false);
      const res = await fetch(`${API}/gallery`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({ url, nadpis, popis, lang })
      });
      if (res.ok) {
        document.getElementById('gallery-url').value    = '';
        document.getElementById('gallery-nadpis').value = '';
        document.getElementById('gallery-popis').value  = '';
        document.getElementById('gallery-lang').value   = 'all';
        showMsg('gallery-msg', 'PÅ™idÃ¡no âœ“', true);
        loadGallery();
      } else showMsg('gallery-msg', 'Chyba!', false);
    }

    async function deletePhoto(id) {
      if (!confirm('Smazat foto?')) return;
      await fetch(`${API}/gallery/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
      loadGallery();
    }

    // â”€â”€ Reviews â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadReviews() {
      const res   = await fetch(`${API}/reviews/all`, { headers: { 'Authorization': `Bearer ${token}` } });
      const items = await res.json();
      document.getElementById('reviews-list').innerHTML = items.map(r => `
        <div class="review-item">
          <div class="info">
            <div class="name">${r.jmeno} ${r.prijmeni}
              <span class="badge ${r.approved ? 'approved' : 'pending'}">${r.approved ? 'schvÃ¡leno' : 'ÄekÃ¡'}</span>
            </div>
            <div class="text">${r.text}</div>
          </div>
          <div>
            ${!r.approved ? `<button onclick="approveReview('${r._id}')">âœ“ SchvÃ¡lit</button>` : ''}
            <button class="secondary" onclick="deleteReview('${r._id}')">âœ•</button>
          </div>
        </div>
      `).join('') || '<p style="color:#888">Å½Ã¡dnÃ© recenze</p>';
    }

    async function approveReview(id) {
      await fetch(`${API}/reviews/${id}/approve`, { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}` } });
      loadReviews();
    }

    async function deleteReview(id) {
      if (!confirm('Smazat recenzi?')) return;
      await fetch(`${API}/reviews/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
      loadReviews();
    }

    function showMsg(id, text, ok) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = 'msg ' + (ok ? 'ok' : 'err');
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 3000);
    }
  </script>
</body>
</html>