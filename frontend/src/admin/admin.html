<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <title>Admin panel</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      padding: 2rem;
    }

    h1 {
      color: #c0392b;
      margin-bottom: 2rem;
    }

    h2 {
      margin: 1.5rem 0 1rem;
      font-size: 1.1rem;
      color: #ccc;
    }

    label {
      display: block;
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 0.3rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    input,
    textarea {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #333;
      color: #fff;
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.95rem;
      margin-bottom: 0.75rem;
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    button {
      background: #c0392b;
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      margin-right: 0.5rem;
    }

    button.secondary {
      background: #333;
    }

    button:hover {
      opacity: 0.85;
    }

    .card {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .msg {
      padding: 0.75rem;
      border-radius: 6px;
      margin-top: 1rem;
      font-size: 0.9rem;
    }

    .msg.ok {
      background: rgba(46, 204, 113, 0.15);
      color: #2ecc71;
    }

    .msg.err {
      background: rgba(192, 57, 43, 0.15);
      color: #c0392b;
    }

    .gallery-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .gallery-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      background: #222;
    }

    .gallery-item img {
      width: 100%;
      height: 130px;
      object-fit: cover;
      display: block;
    }

    .gallery-item button {
      position: absolute;
      top: 6px;
      right: 6px;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
    }

    #login-screen {
      max-width: 400px;
      margin: 5rem auto;
    }

    #app {
      display: none;
      max-width: 960px;
      margin: 0 auto;
    }

    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .review-item {
      background: #222;
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }

    .review-item .info {
      flex: 1;
    }

    .review-item .name {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .review-item .text {
      font-size: 0.9rem;
      color: #aaa;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
      border-radius: 100px;
    }

    .badge.pending {
      background: rgba(241, 196, 15, 0.2);
      color: #f1c40f;
    }

    .badge.approved {
      background: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
    }

    .note {
      font-size: 0.8rem;
      color: #666;
      font-style: italic;
      margin-top: 0.5rem;
    }
  </style>
</head>

<body>

  <div id="login-screen" class="card">
    <h1>üîí Admin</h1>
    <h2>P≈ôihl√°≈°en√≠</h2>
    <input type="password" id="password" placeholder="Heslo" onkeydown="if(event.key==='Enter')login()">
    <button onclick="login()">P≈ôihl√°sit se</button>
    <div id="login-msg" class="msg" style="display:none"></div>
  </div>

  <div id="app">
    <h1>‚öôÔ∏è Admin panel</h1>
    <button class="secondary" onclick="logout()">Odhl√°sit</button>

    <!-- CONTENT -->
    <div class="card">
      <h2>üìù Slu≈æby</h2>
      <label>Nadpis</label>
      <input id="sluzby-nadpis" placeholder="L√©ƒçba bolest√≠ zad">
      <label>Seznam slu≈æeb (ka≈æd√° na nov√Ω ≈ô√°dek)</label>
      <textarea id="sluzby-text" placeholder="1. V√Ωh≈ôezy plot√©nek&#10;2. Bechtƒõrevova nemoc"></textarea>

      <h2>‚úÖ Proƒç za mnou?</h2>
      <label>Nadpis</label>
      <input id="proc-nadpis" placeholder="Proƒç za mnou?">
      <label>D≈Øvody (ka≈æd√Ω na nov√Ω ≈ô√°dek)</label>
      <textarea id="proc-body" placeholder="Metoda nem√° vedlej≈°√≠ √∫ƒçinky&#10;Rychl√© v√Ωsledky"></textarea>

      <h2>üë§ O mnƒõ</h2>
      <label>Nadpis</label>
      <input id="omne-nadpis" placeholder="O mnƒõ">
      <label>Text (kr√°tk√Ω √∫vod)</label>
      <textarea id="omne-text" style="min-height:80px" placeholder="Kr√°tk√Ω popis..."></textarea>
      <label>Body (ka≈æd√Ω na nov√Ω ≈ô√°dek)</label>
      <textarea id="omne-body" placeholder="15 let zku≈°enost√≠&#10;Individu√°ln√≠ p≈ô√≠stup"></textarea>

      <button onclick="saveContent()">üíæ Ulo≈æit v≈°e</button>
      <div id="content-msg" class="msg" style="display:none"></div>

      <p class="note">‚ÑπÔ∏è Kontaktn√≠ √∫daje (telefon, email, adresa) se upravuj√≠ p≈ô√≠mo v souboru index.html</p>
    </div>

    
    <!-- GALLERY -->
<div class="card">
  <h2>üñºÔ∏è Galerie</h2>
  <label>URL obr√°zku</label>
  <input id="gallery-url" placeholder="https://..." oninput="previewGalleryImage()">
  <div id="gallery-preview" style="display:none; margin-bottom:0.75rem;">
    <img id="gallery-preview-img" src="" alt="N√°hled"
      style="max-width:200px; max-height:150px; border-radius:8px; border:1px solid #333; object-fit:cover;">
  </div>
  <label>Nadpis</label>
  <input id="gallery-nadpis" placeholder="N√°zev fotky">
  <label>Popis (voliteln√©)</label>
  <input id="gallery-popis" placeholder="Popis fotky">
  <button onclick="addPhoto()">P≈ôidat foto</button>
  <div id="gallery-msg" class="msg" style="display:none"></div>
  <div class="gallery-list" id="gallery-list"></div>
</div>

    <!-- REVIEWS -->
    <div class="card">
      <h2>‚≠ê Recenze</h2>
      <div class="reviews-list" id="reviews-list"></div>
    </div>
  </div>

  <script>
    // ======= CHANGE THIS FOR LOCAL DEVELOPMENT =======
    const API = '/api';
    // For local: const API = 'http://localhost:8000/api';
    // ==================================================

    let token = localStorage.getItem('admin_token');
    if (token) showApp();

    async function login() {
      const password = document.getElementById('password').value;
      const res = await fetch(`${API}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });
      const data = await res.json();
      if (res.ok) { token = data.token; localStorage.setItem('admin_token', token); showApp(); }
      else showMsg('login-msg', data.message || 'Chyba p≈ôihl√°≈°en√≠', false);
    }

    function logout() { localStorage.removeItem('admin_token'); location.reload(); }

    function showApp() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      loadContent(); loadGallery(); loadReviews();
    }

    // ‚Äî‚Äî CONTENT ‚Äî‚Äî
    async function loadContent() {
      const res = await fetch(`${API}/content`);
      const data = await res.json();
      document.getElementById('sluzby-nadpis').value = data.sluzby?.nadpis || '';
      document.getElementById('sluzby-text').value = data.sluzby?.text || '';
      document.getElementById('proc-nadpis').value = data.proc_za_mnou?.nadpis || '';
      document.getElementById('proc-body').value = (data.proc_za_mnou?.body || []).join('\n');
      document.getElementById('omne-nadpis').value = data.o_mne?.nadpis || '';
      document.getElementById('omne-text').value = data.o_mne?.text || '';
      document.getElementById('omne-body').value = (data.o_mne?.body || []).join('\n');
    }

    async function saveContent() {
      const body = {
        sluzby: {
          nadpis: document.getElementById('sluzby-nadpis').value,
          text: document.getElementById('sluzby-text').value
        },
        proc_za_mnou: {
          nadpis: document.getElementById('proc-nadpis').value,
          body: document.getElementById('proc-body').value.split('\n').filter(l => l.trim())
        },
        o_mne: {
          nadpis: document.getElementById('omne-nadpis').value,
          text: document.getElementById('omne-text').value,
          body: document.getElementById('omne-body').value.split('\n').filter(l => l.trim())
        }
      };
      const res = await fetch(`${API}/content`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify(body)
      });
      showMsg('content-msg', res.ok ? 'Ulo≈æeno ‚úì' : 'Chyba!', res.ok);
    }

    // ‚Äî‚Äî GALLERY ‚Äî‚Äî
    function previewGalleryImage() {
      const url = document.getElementById('gallery-url').value.trim();
      const preview = document.getElementById('gallery-preview');
      const img = document.getElementById('gallery-preview-img');
      if (url) {
        img.src = url;
        img.onerror = () => { preview.style.display = 'none'; };
        img.onload = () => { preview.style.display = 'block'; };
      } else {
        preview.style.display = 'none';
      }
    }

    async function loadGallery() {
      const res = await fetch(`${API}/gallery`);
      const items = await res.json();
      document.getElementById('gallery-list').innerHTML = items.map(item => `
    <div class="gallery-item">
      <img src="${item.url}" alt="${item.popis}" onerror="this.src='https://placehold.co/180x130?text=Error'">
      ${item.nadpis ? `<div style="padding:0.4rem 0.5rem;font-size:0.8rem;font-weight:600;color:#fff;background:rgba(0,0,0,0.6);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.nadpis}</div>` : ''}
      ${item.popis ? `<div style="padding:0.2rem 0.5rem 0.4rem;font-size:0.7rem;color:#aaa;background:rgba(0,0,0,0.6);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.popis}</div>` : ''}
      <button onclick="deletePhoto('${item._id}')">‚úï</button>
    </div>
  `).join('');
    }

    async function addPhoto() {
      const url = document.getElementById('gallery-url').value.trim();
      const nadpis = document.getElementById('gallery-nadpis').value.trim();  // ADD
      const popis = document.getElementById('gallery-popis').value.trim();
      if (!url) return showMsg('gallery-msg', 'URL je povinn√©', false);
      const res = await fetch(`${API}/gallery`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({ url, nadpis, popis })  // ADD nadpis
      });
      if (res.ok) {
        document.getElementById('gallery-url').value = '';
        document.getElementById('gallery-nadpis').value = '';  // ADD
        document.getElementById('gallery-popis').value = '';
        showMsg('gallery-msg', 'P≈ôid√°no ‚úì', true);
        loadGallery();
      } else showMsg('gallery-msg', 'Chyba!', false);
    }

    async function deletePhoto(id) {
      if (!confirm('Smazat foto?')) return;
      await fetch(`${API}/gallery/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
      loadGallery();
    }

    // ‚Äî‚Äî REVIEWS ‚Äî‚Äî
    async function loadReviews() {
      const res = await fetch(`${API}/reviews/all`, { headers: { 'Authorization': `Bearer ${token}` } });
      const items = await res.json();
      document.getElementById('reviews-list').innerHTML = items.map(r => `
    <div class="review-item">
      <div class="info">
        <div class="name">${r.jmeno} ${r.prijmeni}
          <span class="badge ${r.approved ? 'approved' : 'pending'}">${r.approved ? 'schv√°leno' : 'ƒçek√°'}</span>
        </div>
        <div class="text">${r.text}</div>
      </div>
      <div>
        ${!r.approved ? `<button onclick="approveReview('${r._id}')">‚úì Schv√°lit</button>` : ''}
        <button class="secondary" onclick="deleteReview('${r._id}')">‚úï</button>
      </div>
    </div>
  `).join('') || '<p style="color:#888">≈Ω√°dn√© recenze</p>';
    }

    async function approveReview(id) {
      await fetch(`${API}/reviews/${id}/approve`, { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}` } });
      loadReviews();
    }

    async function deleteReview(id) {
      if (!confirm('Smazat recenzi?')) return;
      await fetch(`${API}/reviews/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
      loadReviews();
    }

    function showMsg(id, text, ok) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = 'msg ' + (ok ? 'ok' : 'err');
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 3000);
    }
  </script>
</body>

</html>